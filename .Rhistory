MyTable=df2Flextable(result,vanilla=TRUE)
MyTable
MyTable
MyTable["indirect Effect",,side='top']=chprop(borderProperties(style='line'))
MyTable["indirect Effect",,side='top']=chprop(borderProperties(style='solid'))
MyTable["indirect effect",,side='top']=chprop(borderProperties(style='solid'))
MyTable['indirect effect',,side='top']=chprop(borderProperties(style='solid'))
result
MyTable[result$Variables=='indirect effect',,side='top']=chprop(borderProperties(style='solid'))
MyTable
devtools::document()
library(semMediation)
library(semMediation)
require(lavaan)
require(semPlot)
require(semPlot)
require(semMediation)
require(ggplot2)
require(ReporteRs)
HS.model <- ' visual  =~ x1 + x2 + x3
textual =~ x4 + x5 + x6
speed   =~ x7 + x8 + x9 '
fit <- cfa(HS.model, data = HolzingerSwineford1939)
semPaths(fit)
mediationPlot(fit)
fit <- cfa(HS.model, data = HolzingerSwineford1939)
maxx=60;maxy=30;height=5;width=5;whatLabels="name";useLabel=TRUE;usecolor=TRUE
clean=TRUE;base_size=5;base_family="Arial"
mediationOnly=FALSE;residuals=TRUE;regression=TRUE
indirect=FALSE;secondIndirect=FALSE;mode=1
res=parameterEstimates(fit,standardized=TRUE)
res
df=fit2df(fit)
df
df1=addpos(df)
df1
source('~/ownCloud/Documents/semMediation/R/mediationPlot.R', echo=TRUE)
res=parameterEstimates(fit,standardized=TRUE)
res
df=fit2df(fit)
df
df1=addpos(df)
df1
if(mediationOnly) {
Mgroup=df1[substr(df1$group1,1,1)=="M",]$group1
Mgroup
df1=df1[df1$group1 %in% c("X","Y",Mgroup),]
res=res[(res$label!="")|((res$lhs %in% df1$text)&(res$rhs %in% df1$text)),]
res
}
df2=adjustPos(df1,maxx=maxx,maxy=maxy,height=height,width=width)
df2
df1
df2=adjustPos(df1,maxx=maxx,maxy=maxy,height=height,width=width)
df2
df2
df<-df2
df[df$group=="X",]
df[df$group=="X",][1]
df[df$group=="X",]$text[i]
i=1
df[df$group=="X",]$text[i]
df
if(length(unique(df$group1))==2){
if(("X" %in% unique(df$group1))&("0" %in% unique(df$group1))){
count=nrow(df[df$group=="X",])
for(i in 1:count){
temp=df[df$group=="X",]$text[i]
if(nrow(df[df$group2==temp])>0)
df[df$text==temp,y]=mean(df[df$group2==temp]$y)
}
}
}
df
unique(df$group1)
("X" %in% unique(df$group1))&("0" %in% unique(df$group1))
count=nrow(df[df$group=="X",])
(count=nrow(df[df$group=="X",]))
i=1
temp=df[df$group=="X",]$text[i]
(temp=df[df$group=="X",]$text[i])
if(nrow(df[df$group2==temp])>0)
df[df$text==temp,y]=mean(df[df$group2==temp]$y)
df
df[df$text==temp,y]
df[df$text==temp,]$y=mean(df[df$group2==temp]$y)
(temp=df[df$group=="X",]$text[i])
df[df$text==temp,]$y
df[df$text==temp,]
df<-df2
df
unique(df$group1)
("X" %in% unique(df$group1))&("0" %in% unique(df$group1))
(count=nrow(df[df$group=="X",]))
if(length(unique(df$group1))==2){
if(("X" %in% unique(df$group1))&("0" %in% unique(df$group1))){
count=nrow(df[df$group=="X",])
for(i in 1:count){
(temp=df[df$group=="X",]$text[i])
if(nrow(df[df$group2==temp])>0){
df[df$text==temp,]$y=mean(df[df$group2==temp]$y)
}
}
}
}
df<-df2
df
unique(df$group1)
("X" %in% unique(df$group1))&("0" %in% unique(df$group1))
(count=nrow(df[df$group=="X",]))
i=1
(temp=df[df$group=="X",]$text[i])
nrow(df[df$group2==temp])>0
df[df$text==temp,]$y
df
mean(df[df$group2==temp,]$y)
df<-df2
if(length(unique(df$group1))==2){
if(("X" %in% unique(df$group1))&("0" %in% unique(df$group1))){
count=nrow(df[df$group=="X",])
for(i in 1:count){
(temp=df[df$group=="X",]$text[i])
if(nrow(df[df$group2==temp])>0){
df[df$text==temp,]$y=mean(df[df$group2==temp,]$y)
}
}
df[df$group=="X",]$x=maxx-15
df[df$group=="0",]$x=maxx-15
}
}
df<-df2
df
df<-df2
df
if(length(unique(df$group1))==2){
if(("X" %in% unique(df$group1))&("0" %in% unique(df$group1))){
count=nrow(df[df$group=="X",])
for(i in 1:count){
(temp=df[df$group=="X",]$text[i])
if(nrow(df[df$group2==temp])>0){
df[df$text==temp,]$y=mean(df[df$group2==temp,]$y)
}
}
df[df$group1=="X",]$x=maxx-15
df[df$group1=="0",]$x=maxx-15
}
}
unique(df$group1)
("X" %in% unique(df$group1))&("0" %in% unique(df$group1))
(count=nrow(df[df$group=="X",]))
nrow(df[df$group2==temp])>0
unique(df$group1)
df<-df2
df
unique(df$group1)
("X" %in% unique(df$group1))&("0" %in% unique(df$group1))
(count=nrow(df[df$group=="X",]))
i=1
(temp=df[df$group=="X",]$text[i])
nrow(df[df$group2==temp])>0
df[df$text==temp,]$y
mean(df[df$group2==temp,]$y)
if(length(unique(df$group1))==2){
if(("X" %in% unique(df$group1))&("0" %in% unique(df$group1))){
count=nrow(df[df$group=="X",])
for(i in 1:count){
(temp=df[df$group=="X",]$text[i])
if(nrow(df[df$group2==temp])>0){
df[df$text==temp,]$y=mean(df[df$group2==temp,]$y)
}
}
df[df$group1=="X",]$x=maxx-15
df[df$group1=="0",]$x=maxx-15
}
}
df
adjustPos=function(df,maxx=60,maxy=30,height=3,width=5){
#df=df1;maxx=60;maxy=30;height=3;width=5
df$group3=df$y
count<-nrow(df[df$group1=="0",])
count<-c(count,nrow(df[df$group1=="X",]))
count<-c(count,nrow(df[substr(df$group1,1,1)=="M",]))
count<-c(count,nrow(df[df$group1=="Y",]))
count<-c(count,nrow(df[df$group1=="5",]))
countH<-nrow(df[substr(df$group1,1,1)=="H",])
countH
count
## maxrow 및 maxcol 계산
res=plyr::ddply(df,"group1",nrow)
res
(maxrow=max(res[nchar(res$group1)==1,]$V1))
res$xpos=3
condition1<- (nchar(res$group1)==2)&(as.numeric(substr(res$group1,2,2))<=(count[3]+1)%/%2)
if(nrow(res[condition1,])>0) res[condition1,]$xpos=2
if(nrow(res[nchar(res$group1)==1,])>0) res[nchar(res$group1)==1,]$xpos=1
## maxgroup :  group count except "H"
(maxgroup=nrow(res[substr(res$group1,1,1)!="H",]))
upperCol=res[(substr(res$group1,1,1)=="H")&(res$xpos==2),]
lowerCol=res[(substr(res$group1,1,1)=="H")&(res$xpos==3),]
(maxcol=maxgroup+max(sum(upperCol$V1-1),sum(lowerCol$V1-1)))
maxcol
starty=25
endy=min(starty-(height+1)*(maxrow+1),5)
endy
mediation=0
if(count[3]>0) mediation=1
minx=5
(stepx=5*3)
(maxx=max(maxx,(maxgroup-1)*stepx+2*minx))
(xpos=seq(minx,maxx,stepx))
x<-y<-text<-group<-c()
## group1=="X"
if(count[2]>0) for(i in 1:count[2]){
x=xpos[2]
if(nrow(df[df$group1=="X",])>0){
df[df$group1=="X",]$x=x
df[df$group1=="X",]$y=distributePos(starty+2,endy-2,count[2])
}
}
# group1=="0"
if(count[1]>0)  for(i in 1:count[1]){
x=xpos[1]
if(nrow(df[df$group1=="0",])>0){
df[df$group1=="0",]$x=x
df[df$group1=="0",]$y=distributePos(starty,endy,count[1])
}
}
# group1=="Y"
if(count[4]>0) {
if(nrow(df[df$group1=="Y",])>0){
df[df$group1=="Y",]$x=df[df$group1=="Y",]$x*stepx+minx
# df[df$group1=="Y",]$y=distributePos(starty,min(5,starty-count[4]*(height+1)),count[4])
df[df$group1=="Y",]$y=distributePos(starty,endy,count[4])
}
}
# group1=="5"
if(count[5]>0) {
if(nrow(df[df$group1=="5",])>0){
df[df$group1=="5",]$x=df[df$group1=="5",]$x*stepx+minx
df[df$group1=="5",]$y=distributePos(starty,endy,count[5])
}
}
df
# group1=="M"
if(count[3]>0) {
if(nrow(df[substr(df$group,1,1)=="M",])>0){
(df[substr(df$group,1,1)=="M",]$x=df[substr(df$group,1,1)=="M",]$x*stepx+minx)
}
condition<-(substr(df$group,1,1)=="M")&(df$y==1)
if(nrow(df[condition,])>0){
df[condition,]$y=(starty+endy)/2+stepx+height/2
}
condition2<-(substr(df$group,1,1)=="M")&(df$y==2)
if(nrow(df[condition2,])>0){
df[condition2,]$y=(starty+endy)/2-stepx-height/2
}
}
# group1=="H"
if(countH>0) {
condition<-(substr(df$group,1,1)=="H")&(df$y==1)
tempcount=nrow(df[condition,])
if(tempcount>0){
df[condition,]$y=(starty+endy)/2+stepx*2+height/2
df[condition,]$x=jitterPos(mean(unique(df[condition,]$x))*stepx+minx,width+1,tempcount)
}
condition2<-(substr(df$group,1,1)=="H")&(df$y==2)
tempcount2=nrow(df[condition2,])
if(tempcount2>0){
df[condition2,]$y=(starty+endy)/2-stepx*2-height/2
df[condition2,]$x=jitterPos(mean(unique(df[condition2,]$x))*stepx+minx,width+1,tempcount2)
}
}
df<-df2
df
unique(df$group1)
("X" %in% unique(df$group1))&("0" %in% unique(df$group1))
(count=nrow(df[df$group=="X",]))
i=1
(temp=df[df$group=="X",]$text[i])
nrow(df[df$group2==temp])>0
df[df$text==temp,]$y
mean(df[df$group2==temp,]$y)
if(length(unique(df$group1))==2){
if(("X" %in% unique(df$group1))&("0" %in% unique(df$group1))){
count=nrow(df[df$group=="X",])
for(i in 1:count){
(temp=df[df$group=="X",]$text[i])
if(nrow(df[df$group2==temp])>0){
df[df$text==temp,]$y=mean(df[df$group2==temp,]$y)
}
}
df[df$group1=="X",]$x=maxx-15
df[df$group1=="0",]$x=maxx-15
}
}
df
}
#' Make a data.frame fof ellipse
#' @param hlaxa An integer
nrow(df[df$group2==temp])>0
df[df$text==temp,]$y
df<-df2
df
unique(df$group1)
("X" %in% unique(df$group1))&("0" %in% unique(df$group1))
(count=nrow(df[df$group=="X",]))
i=1
(temp=df[df$group=="X",]$text[i])
nrow(df[df$group2==temp])>0
df[df$text==temp,]$y
mean(df[df$group2==temp,]$y)
if(length(unique(df$group1))==2){
if(("X" %in% unique(df$group1))&("0" %in% unique(df$group1))){
count=nrow(df[df$group=="X",])
for(i in 1:count){
(temp=df[df$group=="X",]$text[i])
if(nrow(df[df$group2==temp,])>0){
df[df$text==temp,]$y=mean(df[df$group2==temp,]$y)
}
}
df[df$group1=="X",]$x=maxx-15
df[df$group1=="0",]$x=maxx-15
}
}
df
df<-df2
df
unique(df$group1)
("X" %in% unique(df$group1))&("0" %in% unique(df$group1))
(count=nrow(df[df$group=="X",]))
i=1
(temp=df[df$group=="X",]$text[i])
nrow(df[df$group2==temp])>0
df[df$text==temp,]$y
mean(df[df$group2==temp,]$y)
if(length(unique(df$group1))==2){
if(("X" %in% unique(df$group1))&("0" %in% unique(df$group1))){
count=nrow(df[df$group=="X",])
for(i in 1:count){
(temp=df[df$group=="X",]$text[i])
if(nrow(df[df$group2==temp,])>0){
df[df$text==temp,]$y=mean(df[df$group2==temp,]$y)
}
}
df[df$group1=="X",]$x=maxx-15
df[df$group1=="0",]$x=15
}
}
df
adjustPos=function(df,maxx=60,maxy=30,height=3,width=5){
#df=df1;maxx=60;maxy=30;height=3;width=5
df$group3=df$y
count<-nrow(df[df$group1=="0",])
count<-c(count,nrow(df[df$group1=="X",]))
count<-c(count,nrow(df[substr(df$group1,1,1)=="M",]))
count<-c(count,nrow(df[df$group1=="Y",]))
count<-c(count,nrow(df[df$group1=="5",]))
countH<-nrow(df[substr(df$group1,1,1)=="H",])
countH
count
## maxrow 및 maxcol 계산
res=plyr::ddply(df,"group1",nrow)
res
(maxrow=max(res[nchar(res$group1)==1,]$V1))
res$xpos=3
condition1<- (nchar(res$group1)==2)&(as.numeric(substr(res$group1,2,2))<=(count[3]+1)%/%2)
if(nrow(res[condition1,])>0) res[condition1,]$xpos=2
if(nrow(res[nchar(res$group1)==1,])>0) res[nchar(res$group1)==1,]$xpos=1
## maxgroup :  group count except "H"
(maxgroup=nrow(res[substr(res$group1,1,1)!="H",]))
upperCol=res[(substr(res$group1,1,1)=="H")&(res$xpos==2),]
lowerCol=res[(substr(res$group1,1,1)=="H")&(res$xpos==3),]
(maxcol=maxgroup+max(sum(upperCol$V1-1),sum(lowerCol$V1-1)))
maxcol
starty=25
endy=min(starty-(height+1)*(maxrow+1),5)
endy
mediation=0
if(count[3]>0) mediation=1
minx=5
(stepx=5*3)
(maxx=max(maxx,(maxgroup-1)*stepx+2*minx))
(xpos=seq(minx,maxx,stepx))
x<-y<-text<-group<-c()
## group1=="X"
if(count[2]>0) for(i in 1:count[2]){
x=xpos[2]
if(nrow(df[df$group1=="X",])>0){
df[df$group1=="X",]$x=x
df[df$group1=="X",]$y=distributePos(starty+2,endy-2,count[2])
}
}
# group1=="0"
if(count[1]>0)  for(i in 1:count[1]){
x=xpos[1]
if(nrow(df[df$group1=="0",])>0){
df[df$group1=="0",]$x=x
df[df$group1=="0",]$y=distributePos(starty,endy,count[1])
}
}
# group1=="Y"
if(count[4]>0) {
if(nrow(df[df$group1=="Y",])>0){
df[df$group1=="Y",]$x=df[df$group1=="Y",]$x*stepx+minx
# df[df$group1=="Y",]$y=distributePos(starty,min(5,starty-count[4]*(height+1)),count[4])
df[df$group1=="Y",]$y=distributePos(starty,endy,count[4])
}
}
# group1=="5"
if(count[5]>0) {
if(nrow(df[df$group1=="5",])>0){
df[df$group1=="5",]$x=df[df$group1=="5",]$x*stepx+minx
df[df$group1=="5",]$y=distributePos(starty,endy,count[5])
}
}
df
# group1=="M"
if(count[3]>0) {
if(nrow(df[substr(df$group,1,1)=="M",])>0){
(df[substr(df$group,1,1)=="M",]$x=df[substr(df$group,1,1)=="M",]$x*stepx+minx)
}
condition<-(substr(df$group,1,1)=="M")&(df$y==1)
if(nrow(df[condition,])>0){
df[condition,]$y=(starty+endy)/2+stepx+height/2
}
condition2<-(substr(df$group,1,1)=="M")&(df$y==2)
if(nrow(df[condition2,])>0){
df[condition2,]$y=(starty+endy)/2-stepx-height/2
}
}
# group1=="H"
if(countH>0) {
condition<-(substr(df$group,1,1)=="H")&(df$y==1)
tempcount=nrow(df[condition,])
if(tempcount>0){
df[condition,]$y=(starty+endy)/2+stepx*2+height/2
df[condition,]$x=jitterPos(mean(unique(df[condition,]$x))*stepx+minx,width+1,tempcount)
}
condition2<-(substr(df$group,1,1)=="H")&(df$y==2)
tempcount2=nrow(df[condition2,])
if(tempcount2>0){
df[condition2,]$y=(starty+endy)/2-stepx*2-height/2
df[condition2,]$x=jitterPos(mean(unique(df[condition2,]$x))*stepx+minx,width+1,tempcount2)
}
}
# unique(df$group1)
# ("X" %in% unique(df$group1))&("0" %in% unique(df$group1))
# (count=nrow(df[df$group=="X",]))
# i=1
# (temp=df[df$group=="X",]$text[i])
# nrow(df[df$group2==temp])>0
# df[df$text==temp,]$y
# mean(df[df$group2==temp,]$y)
#
if(length(unique(df$group1))==2){
if(("X" %in% unique(df$group1))&("0" %in% unique(df$group1))){
count=nrow(df[df$group=="X",])
for(i in 1:count){
(temp=df[df$group=="X",]$text[i])
if(nrow(df[df$group2==temp,])>0){
df[df$text==temp,]$y=mean(df[df$group2==temp,]$y)
}
}
df[df$group1=="X",]$x=maxx-15
df[df$group1=="0",]$x=15
}
}
df
}
library(semMediation)
require(lavaan)
require(semPlot)
require(semMediation)
require(ggplot2)
require(ReporteRs)
HS.model <- ' visual  =~ x1 + x2 + x3
textual =~ x4 + x5 + x6
speed   =~ x7 + x8 + x9 '
fit <- cfa(HS.model, data = HolzingerSwineford1939)
semPaths(fit)
mediationPlot(fit)
source('~/ownCloud/Documents/semMediation/R/mediationPlot.R', echo=TRUE)
semPaths(fit)
mediationPlot(fit)
require(semMediation)
mediationPlot(fit)
library(semMediation)
require(lavaan)
require(semPlot)
require(ggplot2)
require(ReporteRs)
HS.model <- ' visual  =~ x1 + x2 + x3
textual =~ x4 + x5 + x6
speed   =~ x7 + x8 + x9 '
fit <- cfa(HS.model, data = HolzingerSwineford1939)
semPaths(fit)
mediationPlot(fit)
mediationPlot(fit,width=8)
mediationPlot(fit,width=10)
mediationPlot(fit,width=8)
library(semMediation)
HS.model <- ' visual  =~ x1 + x2 + x3
textual =~ x4 + x5 + x6
speed   =~ x7 + x8 + x9 '
fit <- cfa(HS.model, data = HolzingerSwineford1939)
semPaths(fit)
mediationPlot(fit,width=8)
library(semMediation)
mediationPlot(fit,width=8)
semPaths(fit)
mediationPlot(fit,width=8,residuals=TRUE)
library(semMediation)
